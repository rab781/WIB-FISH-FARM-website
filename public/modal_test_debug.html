<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal Debug Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        /* Exact modal CSS from Laravel app */
        .modal-hidden {
            display: none;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex !important;
        }

        .modal-dialog {
            background: white;
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.2s ease-out;
        }

        .modal-overlay.show .modal-dialog {
            transform: scale(1);
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <h1 class="text-2xl font-bold mb-4">Modal Debug Test</h1>
    <p class="mb-4">Testing the exact modal system from Laravel app</p>

    <!-- Test buttons -->
    <div class="space-x-4 mb-4">
        <button id="testBtn1" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
            Open Test Modal 1
        </button>
        <button id="testBtn2" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
            Open Test Modal 2
        </button>
        <button id="closeAllBtn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
            Close All Modals
        </button>
    </div>

    <!-- Test Modal 1 -->
    <div id="testModal1" class="modal-hidden">
        <div class="modal-dialog">
            <div class="p-6">
                <h2 class="text-xl font-bold mb-4">Test Modal 1</h2>
                <p class="mb-4">This is a test modal to verify the modal system is working correctly.</p>
                <div class="flex justify-end space-x-2">
                    <button class="close-modal bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Modal 2 -->
    <div id="testModal2" class="modal-hidden">
        <div class="modal-dialog">
            <div class="p-6">
                <h2 class="text-xl font-bold mb-4">Test Modal 2</h2>
                <p class="mb-4">This is another test modal with Alpine.js compatibility test.</p>
                <div x-data="{ message: 'Alpine.js is working!' }" class="mb-4">
                    <p x-text="message" class="text-green-600"></p>
                </div>
                <div class="flex justify-end space-x-2">
                    <button class="close-modal bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Modal debug script starting...');

        // Get modal elements
        const testModal1 = document.getElementById('testModal1');
        const testModal2 = document.getElementById('testModal2');

        console.log('Modal elements:', { testModal1, testModal2 });

        // Function to close all modals (exact copy from Laravel)
        function closeAllModals() {
            console.log('Closing all modals...');

            [testModal1, testModal2].forEach(modal => {
                if (modal) {
                    modal.classList.remove('modal-overlay', 'show');
                    modal.classList.add('modal-hidden');
                }
            });

            // Remove any body scroll lock
            document.body.style.overflow = '';
        }

        // Function to show modal (exact copy from Laravel)
        function showModal(modal) {
            console.log('showModal called with:', modal);

            if (!modal) {
                console.error('Modal element is null or undefined');
                return;
            }

            console.log('Modal found, proceeding to show...');

            // Close other modals first
            closeAllModals();

            // Show the modal using our custom classes
            modal.classList.remove('modal-hidden');
            modal.classList.add('modal-overlay', 'show');

            console.log('Modal classes updated to:', modal.className);

            // Prevent body scroll
            document.body.style.overflow = 'hidden';

            // Focus management for accessibility
            const firstFocusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (firstFocusable) {
                setTimeout(() => firstFocusable.focus(), 100);
            }

            // Scroll to top to ensure modal is visible
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Event listeners
        document.getElementById('testBtn1').addEventListener('click', function() {
            console.log('Test button 1 clicked');
            showModal(testModal1);
        });

        document.getElementById('testBtn2').addEventListener('click', function() {
            console.log('Test button 2 clicked');
            showModal(testModal2);
        });

        document.getElementById('closeAllBtn').addEventListener('click', function() {
            console.log('Close all button clicked');
            closeAllModals();
        });

        // Close modal buttons
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', function() {
                console.log('Close modal button clicked');
                closeAllModals();
            });
        });

        // Backdrop click to close
        [testModal1, testModal2].forEach(modal => {
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        console.log('Backdrop clicked, closing modal');
                        closeAllModals();
                    }
                });
            }
        });

        // ESC key to close modals
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                console.log('ESC key pressed, closing modals');
                closeAllModals();
            }
        });

        console.log('Modal debug script loaded successfully');
    </script>
</body>
</html>
