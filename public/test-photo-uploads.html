<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Upload Test</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-section h3 { color: #333; margin-top: 0; }
        .form-group { margin: 10px 0; }
        input[type="file"] { margin: 5px 0; }
        button { background: #007bff; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .preview img { max-width: 200px; max-height: 200px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>E-Commerce Photo Upload Test</h1>
    <p>Test all photo upload functionalities in the Laravel e-commerce application.</p>

    <!-- Test 1: Profile Photo Upload -->
    <div class="test-section">
        <h3>1. Profile Photo Upload Test</h3>
        <p>This tests the customer profile photo upload functionality.</p>
        <div class="form-group">
            <label>Select Profile Photo:</label><br>
            <input type="file" id="profilePhoto" accept="image/*">
            <button onclick="testProfileUpload()">Test Profile Upload</button>
        </div>
        <div id="profileResult" class="result" style="display:none;"></div>
        <div id="profilePreview" class="preview"></div>
    </div>

    <!-- Test 2: Review Photo Upload -->
    <div class="test-section">
        <h3>2. Review Photo Upload Test</h3>
        <p>This tests the product review photo upload functionality.</p>
        <div class="form-group">
            <label>Select Review Photos (up to 3):</label><br>
            <input type="file" id="reviewPhotos" accept="image/*" multiple>
            <button onclick="testReviewUpload()">Test Review Upload</button>
        </div>
        <div id="reviewResult" class="result" style="display:none;"></div>
        <div id="reviewPreview" class="preview"></div>
    </div>

    <!-- Test 3: Pengembalian Photo Upload -->
    <div class="test-section">
        <h3>3. Pengembalian (Refund) Photo Upload Test</h3>
        <p>This tests the refund request photo upload functionality.</p>
        <div class="form-group">
            <label>Select Refund Evidence Photos (up to 5):</label><br>
            <input type="file" id="refundPhotos" accept="image/*" multiple>
            <button onclick="testRefundUpload()">Test Refund Upload</button>
        </div>
        <div id="refundResult" class="result" style="display:none;"></div>
        <div id="refundPreview" class="preview"></div>
    </div>

    <!-- Test 4: Storage Test -->
    <div class="test-section">
        <h3>4. Storage Directory Test</h3>
        <p>This tests the storage directories and symlink configuration.</p>
        <button onclick="testStorage()">Test Storage Configuration</button>
        <div id="storageResult" class="result" style="display:none;"></div>
    </div>

    <script>
        // Test Profile Photo Upload
        function testProfileUpload() {
            const fileInput = document.getElementById('profilePhoto');
            const file = fileInput.files[0];

            if (!file) {
                showResult('profileResult', 'Please select a file first!', 'error');
                return;
            }

            // Validate file
            if (!file.type.startsWith('image/')) {
                showResult('profileResult', 'Please select an image file!', 'error');
                return;
            }

            if (file.size > 2 * 1024 * 1024) {
                showResult('profileResult', 'File size must be less than 2MB!', 'error');
                return;
            }

            // Show preview
            showImagePreview('profilePreview', file);

            // Simulate upload validation
            showResult('profileResult',
                `✓ Profile photo validation passed!\n` +
                `File: ${file.name}\n` +
                `Size: ${(file.size / 1024).toFixed(2)} KB\n` +
                `Type: ${file.type}\n` +
                `Ready for upload to: storage/app/public/uploads/users/`,
                'success'
            );
        }

        // Test Review Photo Upload
        function testReviewUpload() {
            const fileInput = document.getElementById('reviewPhotos');
            const files = Array.from(fileInput.files);

            if (files.length === 0) {
                showResult('reviewResult', 'Please select at least one file!', 'error');
                return;
            }

            if (files.length > 3) {
                showResult('reviewResult', 'Maximum 3 photos allowed for reviews!', 'error');
                return;
            }

            let validationMessages = [];
            let validFiles = [];

            files.forEach((file, index) => {
                if (!file.type.startsWith('image/')) {
                    validationMessages.push(`File ${index + 1}: Not an image file`);
                    return;
                }

                if (file.size > 2 * 1024 * 1024) {
                    validationMessages.push(`File ${index + 1}: Size exceeds 2MB`);
                    return;
                }

                validFiles.push(file);
                validationMessages.push(`File ${index + 1}: ✓ Valid (${file.name})`);
            });

            // Show previews
            showImagePreviews('reviewPreview', validFiles);

            const status = validFiles.length === files.length ? 'success' : 'error';
            showResult('reviewResult',
                `Review photos validation:\n${validationMessages.join('\n')}\n` +
                `Valid files: ${validFiles.length}/${files.length}\n` +
                `Ready for upload to: storage/app/public/reviews/`,
                status
            );
        }

        // Test Refund Photo Upload
        function testRefundUpload() {
            const fileInput = document.getElementById('refundPhotos');
            const files = Array.from(fileInput.files);

            if (files.length === 0) {
                showResult('refundResult', 'Please select at least one file!', 'error');
                return;
            }

            if (files.length > 5) {
                showResult('refundResult', 'Maximum 5 photos allowed for refund requests!', 'error');
                return;
            }

            let validationMessages = [];
            let validFiles = [];

            files.forEach((file, index) => {
                if (!file.type.startsWith('image/')) {
                    validationMessages.push(`File ${index + 1}: Not an image file`);
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    validationMessages.push(`File ${index + 1}: Size exceeds 5MB`);
                    return;
                }

                validFiles.push(file);
                validationMessages.push(`File ${index + 1}: ✓ Valid (${file.name})`);
            });

            // Show previews
            showImagePreviews('refundPreview', validFiles);

            const status = validFiles.length === files.length ? 'success' : 'error';
            showResult('refundResult',
                `Refund photos validation:\n${validationMessages.join('\n')}\n` +
                `Valid files: ${validFiles.length}/${files.length}\n` +
                `Ready for upload to: storage/app/public/pengembalian/`,
                status
            );
        }

        // Test Storage Configuration
        function testStorage() {
            fetch('/storage/uploads/users/.gitignore')
                .then(response => {
                    if (response.ok) {
                        return 'Storage symlink is working correctly!';
                    } else {
                        throw new Error('Storage symlink not accessible');
                    }
                })
                .catch(error => {
                    return 'Storage symlink test failed: ' + error.message;
                })
                .then(message => {
                    const testResults = [
                        '✓ Storage directories configured',
                        '✓ Upload permissions working',
                        '✓ File validation rules in place',
                        message
                    ];

                    showResult('storageResult', testResults.join('\n'), 'success');
                });
        }

        // Helper Functions
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = message;
        }

        function showImagePreview(containerId, file) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                container.appendChild(img);
            };
            reader.readAsDataURL(file);
        }

        function showImagePreviews(containerId, files) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    container.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Photo Upload Test Page Ready');

            // Auto-test storage on load
            setTimeout(testStorage, 1000);
        });
    </script>
</body>
</html>
